<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.p2g.mybatis.dao.sys.AdminMenuExpandMapper">
	<resultMap id="BaseResultMap" type="com.p2g.mybatis.model.generator.AdminMenu">
		<!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
		<id column="admin_menu_id" jdbcType="INTEGER" property="adminMenuId" />
		<result column="menu_name" jdbcType="VARCHAR" property="menuName" />
		<result column="req_url" jdbcType="VARCHAR" property="reqUrl" />
		<result column="level" jdbcType="INTEGER" property="level" />

	</resultMap>
	<select id="query" parameterType="java.util.Map" resultType="java.lang.Integer">
		select admin_menu_id from admin_menu
		<where>
			<if test="menuName!=null and menuName!=''">
				and menu_name=#{menuName}
			</if>
		</where>
	</select>

	<select id="queryAdminMenus"  resultMap="BaseResultMap">
		SELECT t.admin_menu_id,t.menu_name,t.level,req_url FROM admin_menu t WHERE t.state=1 ORDER BY t.admin_menu_id,t.parent_id
	</select>

	<select id="getMenu" resultType="java.lang.Integer">
		 SELECT COUNT(1) FROM admin_menu p
		WHERE p.admin_menu_id=#{adminMenuId}
		AND (EXISTS (SELECT 1 FROM admin_user_role ur
		JOIN admin_role_menu rp ON ur.role_id=rp.role_id
		 WHERE ur.admin_id=#{adminId} AND rp.menu_id=p.admin_menu_id)
		OR EXISTS (SELECT 1 FROM admin_user_menu up
		 WHERE up.admin_id=#{adminId} AND up.menu_id=p.admin_menu_id))

	</select>
</mapper>